<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Master Barber</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --red: #8e1a1a; }
        body { font-family: 'Montserrat', sans-serif; background: #121212; color: #333; padding: 20px; margin: 0; }
        .admin-card { max-width: 450px; margin: auto; background: white; padding: 25px; border-radius: 15px; }
        h2 { text-align: center; border-bottom: 3px solid var(--gold); padding-bottom: 10px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .grid-horas { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .hora-btn { padding: 15px 5px; border: 2px solid #eee; border-radius: 8px; text-align: center; cursor: pointer; font-weight: bold; background: #f9f9f9; }
        .hora-btn.bloqueada { background: var(--red) !important; color: white !important; border-color: var(--red); }
        .leyenda { margin-top: 20px; font-size: 0.8rem; text-align: center; background: #eee; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="admin-card">
    <h2>CONTROL DE CITAS</h2>
    <label>Barbero</label>
    <select id="barbero" onchange="cargarEstado()">
        <option value="Fabian Ortiz">Fabian Ortiz</option>
        <option value="Andrés Silva">Andrés Silva</option>
    </select>

    <label>Fecha</label>
    <input type="date" id="fechaAdmin" onchange="cargarEstado()">

    <div class="grid-horas" id="gridAdmin"></div>
    <div class="leyenda">Toca una hora para bloquearla (Rojo) o liberarla (Gris).</div>
</div>

<script>
    const API_URL = "https://mis-barberias.onrender.com";
    const horasArr = ["08:00", "08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30"];

    async function cargarEstado() {
        const fecha = document.getElementById('fechaAdmin').value;
        const barbero = document.getElementById('barbero').value;
        if(!fecha) return;

        const res = await fetch(`${API_URL}/disponibilidad?fecha=${fecha}&barbero=${barbero}`);
        const data = await res.json();
        const container = document.getElementById('gridAdmin');
        container.innerHTML = "";
        
        horasArr.forEach(h => {
            const div = document.createElement('div');
            div.className = "hora-btn";
            div.innerText = h;
            
            const ocupada = data.ocupadas.includes(h) || data.bloqueadas.includes(h);
            if(ocupada) div.classList.add('bloqueada');

            div.onclick = () => toggleBloqueo(h, ocupada);
            container.appendChild(div);
        });
    }

    async function toggleBloqueo(hora, estaBloqueada) {
        const fecha = document.getElementById('fechaAdmin').value;
        const barbero = document.getElementById('barbero').value;
        const estado = estaBloqueada ? 'L' : 'B';

        try {
            const res = await fetch(`${API_URL}/admin/bloquear`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fecha, hora, barbero, estado })
            });
            if(res.ok) cargarEstado();
        } catch(e) { alert("Error de conexión"); }
    }

    document.getElementById('fechaAdmin').valueAsDate = new Date();
    cargarEstado();
</script>
</body>
</html>
